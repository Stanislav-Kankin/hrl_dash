<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitrix24 Analytics Dashboard</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üìä Bitrix24 Analytics Dashboard</h1>
            <p>–î–∞—à–±–æ—Ä–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–µ—Å–µ–π–ª–∞</p>
        </div>

        <div class="filters-section">
            <div class="filter-group">
                <div class="filter-item">
                    <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏:</label>
                    <select id="employeesSelect">
                        <option value="all">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label>–ü–µ—Ä–∏–æ–¥:</label>
                    <select id="periodSelect">
                        <option value="7">7 –¥–Ω–µ–π</option>
                        <option value="30" selected>30 –¥–Ω–µ–π</option>
                        <option value="90">90 –¥–Ω–µ–π</option>
                        <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                    </select>
                </div>

                <div class="filter-item" id="customDateRange" style="display: none;">
                    <label>–î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç:</label>
                    <div class="date-range-inputs">
                        <input type="date" id="startDate">
                        <span class="date-range-separator">‚Äî</span>
                        <input type="date" id="endDate">
                    </div>
                </div>

                <div class="filter-item">
                    <label>–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</label>
                    <select id="activityTypeSelect">
                        <option value="all">–í—Å–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</option>
                        <option value="2">–ó–≤–æ–Ω–∫–∏</option>
                        <option value="6">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</option>
                        <option value="4">–ó–∞–¥–∞—á–∏</option>
                        <option value="1">–í—Å—Ç—Ä–µ—á–∏</option>
                    </select>
                </div>

                <div class="filter-item" style="min-width: auto;">
                    <label style="visibility: hidden;">–î–µ–π—Å—Ç–≤–∏—è</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="apply-btn" onclick="applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        <button class="clear-btn" onclick="clearCache()" title="–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à">üîÑ</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="quick-actions">
            <div class="quick-buttons">
                <button class="quick-btn active" onclick="toggleQuickAction('all')">–í—Å–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</button>
                <button class="quick-btn" onclick="toggleQuickAction('calls')">–¢–æ–ª—å–∫–æ –∑–≤–æ–Ω–∫–∏</button>
                <button class="quick-btn" onclick="toggleQuickAction('comments')">–¢–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</button>
                <button class="quick-btn" onclick="toggleQuickAction('tasks')">–¢–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏</button>
                <button class="quick-btn" onclick="testConnection()">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
                <button class="quick-btn" onclick="debugUsers()">üêõ –û—Ç–ª–∞–¥–∫–∞</button>
                <button class="quick-btn" onclick="findUsers()">üîç –ü–æ–∏—Å–∫</button>
            </div>
        </div>

        <div class="results-section">
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                    <div class="value" id="activeUsers">0</div>
                    <div class="subtext" id="usersMessage">–ù–∞–π–¥–µ–Ω–æ 0 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                </div>
                <div class="summary-card">
                    <h3>–í—Å–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π</h3>
                    <div class="value" id="totalActivities">0</div>
                    <div class="subtext" id="periodMessage">–∑–∞ 30 –¥–Ω–µ–π</div>
                </div>
                <div class="summary-card">
                    <h3>–ó–≤–æ–Ω–∫–∏</h3>
                    <div class="value" id="totalCalls">0</div>
                    <div class="subtext">–≤—Å–µ–≥–æ —Å–æ–≤–µ—Ä—à–µ–Ω–æ</div>
                </div>
                <div class="summary-card">
                    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
                    <div class="value" id="totalComments">0</div>
                    <div class="subtext">–Ω–∞–ø–∏—Å–∞–Ω–æ</div>
                </div>
                <div class="summary-card">
                    <h3>–°—Ä–µ–¥–Ω–µ–µ –≤ –¥–µ–Ω—å</h3>
                    <div class="value" id="avgPerDay">0</div>
                    <div class="subtext">–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π</div>
                </div>
                <div class="summary-card">
                    <h3>–°–∞–º–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ä–µ–¥–∞</h3>
                    <div class="value" id="mostActiveDay">-</div>
                    <div class="subtext">–¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏</div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
            <div class="charts-section">
                <div class="charts-row">
                    <div class="chart-container">
                        <h3>üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏</h3>
                        <canvas id="weekActivityChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>üïí –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º</h3>
                        <canvas id="hourActivityChart"></canvas>
                    </div>
                </div>
                <div class="charts-row">
                    <div class="chart-container">
                        <h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º</h3>
                        <canvas id="typeDistributionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>üìÖ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h3>
                        <canvas id="dailyActivityChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                            <th>–î–Ω–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</th>
                            <th>–ó–≤–æ–Ω–∫–∏</th>
                            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</th>
                            <th>–ó–∞–¥–∞—á–∏</th>
                            <th>–í—Å–µ–≥–æ</th>
                            <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <tr>
                            <td colspan="8" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="details-panel" id="detailsPanel">
                <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º JavaScript —Ñ–∞–π–ª—ã -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/charts.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>